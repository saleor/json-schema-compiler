# @saleor/json-schema-compiler

Usage:

```bash
pnpm saleor-schema-compiler compile ./src/schemas
```

With external definitions.json file:

```bash
pnpm saleor-schema-compiler compile ./src/schemas --definitions ./src/schemas/definitions.json
```

## Description

It's a CLI tool that takes a directory and recursively transforms all JSON schemas it found into two files: `.d.mts` and `.mjs`. The first one contains types and the second one is a JS standalone validator:

<img width="415" alt="Screenshot 2023-06-22 at 14 58 14" src="https://github.com/saleor/json-schema-compiler/assets/1338731/f5d4504b-fff0-49a3-9e94-c1e36bd37b95">

### Example

#### Input
##### `TransactionCancelationRequestedResponse.schema.json`
```json
{
  "$schema": "http://json-schema.org/draft-07/schema",
  "type": "object",
  "properties": {
    "pspReference": { "type": "string" },
    "result": {
      "$ref": "definitions.json#/definitions/TransactionCancelationRequestedAllowedResult"
    },
    "amount": { "$ref": "definitions.json#/definitions/PositiveDecimal" },
    "time": { "$ref": "definitions.json#/definitions/DateTime" },
    "externalUrl": { "type": "string" },
    "message": { "type": "string" }
  },
  "additionalProperties": false,
  "required": ["pspReference"]
}
```

##### `definitions.json`
```json
{
  "$schema": "http://json-schema.org/draft-07/schema",
  "$id": "definitions.json",
  "definitions": {
    "PositiveDecimal": { "type": "number", "minimum": 0 },
    "DateTime": { "type": "string", "format": "date-time" },
    "TransactionCancelationRequestedAllowedResult": {
      "anyOf": [
        { "type": "string", "const": "CANCEL_SUCCESS" },
        { "type": "string", "const": "CANCEL_FAILURE" }
      ]
    }
  }
}
```

##### Command:
```bash
pnpm saleor-schema-compiler compile ./src/schemas --definitions ./src/schemas/definitions.json
```

#### Output
##### `TransactionCancelationRequestedResponse.d.mts`:
```ts
import type { ValidateFunction } from "ajv";
import type { JSONObject } from '../../types';
/* eslint-disable */
/**
 * This file was automatically generated by json-schema-to-typescript.
 * DO NOT MODIFY IT BY HAND. Instead, modify the source JSONSchema file,
 * and run json-schema-to-typescript to regenerate this file.
 */

export interface TransactionCancelationRequestedResponse {
  pspReference: string;
  result?: "CANCEL_SUCCESS" | "CANCEL_FAILURE";
  amount?: number;
  time?: string;
  externalUrl?: string;
  message?: string;
}

declare const ValidateTransactionCancelationRequestedResponse: ValidateFunction<TransactionCancelationRequestedResponse>;
export default ValidateTransactionCancelationRequestedResponse;
```

##### `TransactionCancelationRequestedResponse.mjs`

Contains a standalone validator function. Exports `default` function that a `ValidateFunction` from Ajv library.

#### Usage
Generated code can be used as follows:

```ts
// As a type:
import { type TransactionCancelationRequestedResponse } from "./src/schemas/TransactionCancelationRequested/TransactionCancelationRequestedResponse.mjs";

// As a validator:
import ValidateTransactionCancelationRequestedResponse from "./src/schemas/TransactionCancelationRequested/TransactionCancelationRequestedResponse.mjs";

const data: unknown = { /* â€¦ */ };
const isDataValid = ValidateTransactionCancelationRequestedResponse(data); // true | false

if (isDataValid) {
  data // data has proper type here! TransactionCancelationRequestedResponse
}
```
